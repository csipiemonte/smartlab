<!DOCTYPE HTML>
<html manifest="OfflineApp.appcache">
<head>
<meta charset="utf-8">
<title>Smart Trek Visualizer</title>
<meta name="generator" content="NSB/AppStudio 4.2.2.0$zkdb" />
<meta name='date' content='2014-10-09 14:22:40.197630' />
<meta name='version' content='1.0.0' />
<meta name='viewport' content='width=device-width, initial-scale=1, user-scalable=no, minimal-ui' />
<meta name='apple-mobile-web-app-capable' content='YES' />
<meta name='mobile-web-app-capable' content='yes' />
<meta name='apple-mobile-web-app-status-bar-style' content='black-translucent' />
<meta name='apple-mobile-web-app-title' content='' />
<meta name='copyright' content='Copyright 2014 Società ABC' />
<noscript><h1>JavaScript must be enabled!</h1></noscript>
<link rel='apple-touch-icon' href='nsb/images/LauncherIcon57.png' />
<!-- Startup images -->
<!-- iOS 6 & 7 iPad (retina, portrait) -->
<link href='splash/ios/1536x2008.png'
      media='(device-width: 768px) and (device-height: 1024px)
         and (orientation: portrait)
         and (-webkit-device-pixel-ratio: 2)'
      rel='apple-touch-startup-image'>
<!-- iOS 6 & 7 iPad (retina, landscape) -->
<link href='splash/ios/1496x2048.png'
      media='(device-width: 768px) and (device-height: 1024px)
         and (orientation: landscape)
         and (-webkit-device-pixel-ratio: 2)'
      rel='apple-touch-startup-image'>
<!-- iOS 6 iPad (portrait) -->
<link href='splash/ios/768x1004.png'
      media='(device-width: 768px) and (device-height: 1024px)
         and (orientation: portrait)
         and (-webkit-device-pixel-ratio: 1)'
      rel='apple-touch-startup-image'>
<!-- iOS 6 iPad (landscape) -->
<link href='splash/ios/748x1024.png'
      media='(device-width: 768px) and (device-height: 1024px)
         and (orientation: landscape)
         and (-webkit-device-pixel-ratio: 1)'
      rel='apple-touch-startup-image'>
<!-- iOS 6 & 7 iPhone 5 -->
<link href='splash/ios/640x1096.png'
      media='(device-width: 320px) and (device-height: 568px)
         and (-webkit-device-pixel-ratio: 2)'
      rel='apple-touch-startup-image'>
<!-- iOS 6 & 7 iPhone (retina) -->
<link href='splash/ios/640x920.png'
      media='(device-width: 320px) and (device-height: 480px)
         and (-webkit-device-pixel-ratio: 2)'
      rel='apple-touch-startup-image'>
<!-- iOS 6 iPhone -->
<link href='splash/ios/320x460.png'
      media='(device-width: 320px) and (device-height: 480px)
         and (-webkit-device-pixel-ratio: 1)'
      rel='apple-touch-startup-image'>
<link rel='icon' sizes='192x192' href='nsb/images/196.png' />
<script src="nsb/jquery.js"></script>
<script src="nsb/hfunc.js"></script>
<link href="nsb/nsbstyle.css" rel="stylesheet">
<script src="nsb/fastclick.js"></script>
<script src="nsb/jquery.mobile.js"></script>
<link href="nsb/jquery.mobile.css" rel="stylesheet">
<script src="nsb/complexfunctions.js"></script>
<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>
<script src="nsb/iscroll.js"></script>



<style type="text/css">
#Line1 {position:absolute; left:10px; right:10px; top:5px; bottom:auto; height:733px; width:945px; margin:0px;}
#btnConnetti {position:absolute; left:31px; right:auto; top:73px; bottom:auto; height:auto; width:100px}
#btnDisconnetti {position:absolute; left:140px; right:auto; top:73px; bottom:auto; height:auto; width:100px}
#GoogleMap1 {position:absolute; left:45px; right:auto; top:146px; bottom:auto; height:430px; width:900px}
#Label1 {position:absolute; left:263px; right:auto; top:72px; bottom:auto; height:auto; width:70px}
#cmbSensore {position:absolute; left:338px; right:auto; top:71px; bottom:auto; height:auto; width:254px}
#lblSensore {position:absolute; left:600px; right:auto; top:71px; bottom:auto; height:34px; width:348px}
#Label2 {position:absolute; left:362px; right:auto; top:15px; bottom:auto; height:auto; width:312px}
#Image1 {position:absolute; left:24px; right:auto; top:10px; bottom:auto; height:44px; width:203px}
#Image2 {position:absolute; left:879px; right:auto; top:14px; bottom:auto; height:39px; width:83px}
#tblSensor_scroller {position: absolute; overflow:hidden; width:898px; height:165px; left:47px; top:580px; right:auto; bottom:auto;}
#tblSensor {position:absolute; left:0px; top:0px; width:100%; height:auto }
#Label3 {position:absolute; left:42px; right:auto; top:120px; bottom:auto; height:auto; width:135px}
#fltBounds {position:absolute; left:178px; right:auto; top:116px; bottom:auto; height:auto; width:auto}
#lblAlert {position:absolute; left:311px; right:auto; top:123px; bottom:auto; height:auto; width:309px}
body * {font-family:helvetica}
</style>
</head>
<body style="margin:0px;-ms-touch-action:none;">
<script>window.addEventListener('load', function() {new FastClick.attach(document.body)}, false)</script>
<div data-role="page" id="Page_jqm" data-theme="a" style="">

<form id="Form1" action="" method="GET" onsubmit="return false;" style="display:none; height:100%; position:absolute; top:0px; left:0px; width:100%; ">
<script>
Form1.innerHTML=[  "<hr id='Line1' class='' style='background-color:grigio;border-style:solid;border-color:gray;border-width:1px;' hidden=\'true\'>",
  "<button id='btnConnetti' class='ui-btn ui-mini  ui-btn-inline ui-icon- ui-btn-icon-none  ' style='margin:0px; overflow:visible;  font-family:; font-style:; font-weight:; ;  ' data-nsb-type=Button_jqm>Connect</button>",
  "<button id='btnDisconnetti' class='ui-btn ui-mini  ui-btn-inline ui-icon- ui-btn-icon-none  ' style='margin:0px; overflow:visible;  font-family:; font-style:; font-weight:; ;  ' data-nsb-type=Button_jqm>Logout</button>",
  "<div id=GoogleMap1 style='background:#F0FFFF;'></div>",
  "<div id='Label1' class='' data-nsb-type=Label style='text-align:left; text-shadow:none; font-size:16px; font-family:helvetica; font-style:normal; font-weight:bold; color:black; background-color:trasparente; border-style:;border-color:transparent;border-width:1px; ' >Sensor:</div>",
  NSB.Select_jqm('cmbSensore', '', '1,2', 0, 1, '', '','', 'arrow-d', 'right', 'false', 'true', 'a', '', 'data-mini=true', '', '','', ''),
  "<div id='lblSensore' class='' data-nsb-type=Label style='text-align:left; text-shadow:none; font-size:14px; font-family:helvetica; font-style:normal; font-weight:bold; color:black; background-color:trasparente; border-style:;border-color:transparent;border-width:1px; ' >Label</div>",
  "<div id='Label2' class='' data-nsb-type=Label style='text-align:left; text-shadow:none; font-size:30px; font-family:helvetica; font-style:normal; font-weight:bold; color:black; background-color:trasparente; border-style:;border-color:transparent;border-width:1px; ' >Smart Trek Visualizer</div>",
  "<div id='Image1' data-nsb-type=image><img src='img/logosdp.jpg'  height=100% width=100% name='Image1_img' style='' usemap='Image1_map'></div>",
  "<div id='Image2' data-nsb-type=image><img src='img/logoCSI.png'  height=100% width=100% name='Image2_img' style='' usemap='Image2_map'></div>",
  NSB.Grid("tblSensor", "6", "7", "", "11%, 23%, 18%, 19%, 11%, 10%, 9%", "Sensor, TS, Latitude, Longitude, Altitude [m], Speed [m/s], Inbound", "", "style=table-layout:fixed;\u000Afont-size:10;", "", ""),
  "<div id='Label3' class='' data-nsb-type=Label style='text-align:left; text-shadow:none; font-size:16px; font-family:helvetica; font-style:normal; font-weight:bold; color:black; background-color:trasparente; border-style:;border-color:transparent;border-width:1px; ' >Map auto resize:</div>",
  "<div id='fltBounds' style=''><select id='fltBounds_inner' name='fltBounds' data-role=flipswitch data-mini=true data-corners='false' style='' class=' '><option>Off</option><option>On</option></select></div>",
  "<div id='lblAlert' class='' data-nsb-type=Label style='text-align:center; text-shadow:none; font-size:16px; font-family:helvetica; font-style:normal; font-weight:bold; color:red; background-color:trasparente; border-style:;border-color:transparent;border-width:1px; ' > no alert</div>",
  ].join('');
</script>
</form>

</div>
<script>
if(!navigator.cookieEnabled) NSB.MsgBox('Please turn cookies on.');
(function(){var all=document.getElementsByTagName('*');for(var i=0;i<all.length;i++)if(typeof all[i].id!='undefined'&&typeof window[all[i].id]=='undefined')window[all[i].id]=all[i];})()

window.addEventListener('load', function() {
  Form1.style.display = 'block';

  NSB.addProperties(Line1);
  NSB.addDisableProperty(btnConnetti);
  NSB.addProperties(btnConnetti);

  NSB.addDisableProperty(btnDisconnetti);
  NSB.addProperties(btnDisconnetti);

  NSB.addProperties(GoogleMap1);
  GoogleMap1.mapOptions={
    disableDefaultUI: True,
    disableDoubleClickZoom: True,
    draggable: False,
    draggableCursor: '',
    draggingCursor: '',
    heading: 0,
    keyboardShortcuts: True,
    latitude: '45.0781',
    longitude: '7.6761',
    mapMaker: False,
    mapTypeId: 'roadmap',
    maxZoom: 10,
    noClear: False,
    scrollwheel: False,
    streetViewControl: False,
    tilt: 0,
    zoom: 10,
    zoomControl: False,
    };
  GoogleMap1.setMarker = NSB.GoogleMapSetMarker;
  GoogleMap1.refresh = NSB.GoogleMapRefresh;
  GoogleMap1.refresh();


  NSB.addProperties(Label1);
  if(typeof(cmbSensore)=='undefined') cmbSensore={id:'cmbSensore'};
  NSB.Select_jqm_init(cmbSensore,'','');


  NSB.addProperties(lblSensore);


  NSB.addProperties(Label2);
  NSB.addProperties(Image1);
  NSB.addProperties(Image2);
  tblSensor_ref = new IScroll(tblSensor_scroller,{ mouseWheel:true, scrollbars:true, bounce:true, zoom:false,click:iScrollClick()});
  tblSensor.refresh=function(){setTimeout(NSB.refresh,100,tblSensor_ref)};
  tblSensor.GridRefreshWidth=function(){setTimeout(NSB.GridRefreshWidth,10,tblSensor)};
  NSB.Grid_init('tblSensor');
  NSB.addProperties(tblSensor,tblSensor_scroller)


  NSB.addProperties(Label3);
  $('#fltBounds .ui-flipswitch').css('margin','0px');
  fltBounds.value=function() {return fltBounds_inner.options[fltBounds_inner.selectedIndex].innerHTML;}
  fltBounds.setting=function() {return fltBounds_inner.options[fltBounds_inner.selectedIndex].innerHTML!='Off';}
  fltBounds.setValue=function(n) {$('#fltBounds_inner').val(n).flipswitch('refresh'); }
  NSB.addDisableProperty(fltBounds);NSB.addProperties(fltBounds);


  NSB.addProperties(lblAlert);
  Form1.style.display = 'none';
  
}, false);
Form1.onsubmit=function(event){window.event.stopPropagation();window.event.preventDefault()};
NSB.addProperties(Form1);
var NUMSENSOR = 5;
var sensor=createMultiDimArray(NUMSENSOR);
var marker=createMultiDimArray(NUMSENSOR);
var markerH=createMultiDimArray(NUMSENSOR);
var client;
var topics;
var topics2;
var idSensore;
var tipoOp;
var map;
var autobounds;
var lineaConfineCoords;
var lineaConfine;
var poliConfineCoords;
var poliConfine;

 // manage the click on "Connect" button
btnConnetti.onclick = function() { savethefunction_rvar="";
   var urlClient;
   var markerBounds;
   var pnt;
 // istantiate a STOMP client
    urlClient = "ws://stream.smartdatanet.it/ws";
    client = Stomp.client(urlClient);
    client.connect("guest" , "Aekieh6F" , connectCallBack, errorCallback);
    markerBounds = new google.maps.LatLngBounds();
    pnt = new google.maps.LatLng(45.020169, 7.527439);
    markerBounds.extend(pnt);
    pnt = new google.maps.LatLng(45.122730, 7.762615);
    markerBounds.extend(pnt);
    map.fitBounds(markerBounds);
return savethefunction_rvar; }

btnDisconnetti.onclick = function() { savethefunction_rvar="";
   var markerBounds;
   var pnt;
 // disconnect the server and reset the screen view
    client.disconnect(disconnectCallback);
    btnConnetti.disabled = False;
    btnDisconnetti.disabled = True;
    cmbSensore.disabled = False;
    markerBounds = new google.maps.LatLngBounds();
    pnt = new google.maps.LatLng(45.020169, 7.527439);
    markerBounds.extend(pnt);
    pnt = new google.maps.LatLng(45.122730, 7.762615);
    markerBounds.extend(pnt);
    map.fitBounds(markerBounds);
return savethefunction_rvar; }

 // init the screen view
Form1.onshow = function() { savethefunction_rvar="";
   var point;
 // define sensor metadata
    sensor[0] = {name: "phonegps01" , id: "cc1bfe50-491c-560d-a235-0e4134bbdc23" , topic: "/topic/output.smartlab.cc1bfe50-491c-560d-a235-0e4134bbdc23_position" , marked: 0, lat: 0, lon: 0, alt: 0, speed: 0, ts: "null" , inbound: "false"}
    sensor[1] = {name: "phonegps02" , id: "5391c45d-7350-5f9b-b971-f711e2766123" , topic: "/topic/output.smartlab.5391c45d-7350-5f9b-b971-f711e2766123_position" , marked: 0, lat: 0, lon: 0, alt: 0, speed: 0, ts: "null" , inbound: "false"}
    sensor[2] = {name: "phonegps03" , id: "a8b223bc-6aa8-5fa2-a217-32546bbd5b70" , topic: "/topic/output.smartlab.a8b223bc-6aa8-5fa2-a217-32546bbd5b70_position" , marked: 0, lat: 0, lon: 0, alt: 0, speed: 0, ts: "null" , inbound: "false"}
    sensor[3] = {name: "phonegps04" , id: "3a58c011-1ad5-5b60-b1fc-68f8d81098e0" , topic: "/topic/output.smartlab.3a58c011-1ad5-5b60-b1fc-68f8d81098e0_position" , marked: 0, lat: 0, lon: 0, alt: 0, speed: 0, ts: "null" , inbound: "false"}
    sensor[4] = {name: "phonegps05" , id: "06bbb064-e808-50b6-9fcc-bcf43550d09e" , topic: "/topic/output.smartlab.06bbb064-e808-50b6-9fcc-bcf43550d09e_position" , marked: 0, lat: 0, lon: 0, alt: 0, speed: 0, ts: "null" , inbound: "false"}

 // GUI Init
 //button
    btnConnetti.disabled = False;
    btnDisconnetti.disabled = True;
    cmbSensore.disabled = False;

 // combo box
    for   (i = 0; i  <= (NUMSENSOR-1); i ++) {
      if(sensor[i].name != "n.d.") {
        cmbSensore.addItem(sensor[i].name, sensor[i].name);
      }
  }

    cmbSensore.addItem("all phone (no filter)" , "all");
    cmbSensore.addItem("all phone filtered" , "allfilter");
    cmbSensore.addItem("all phone filtered polygon" , "allfiltergeo");

 // label
    lblSensore.Caption = cmbSensore.selectedValue();
    idSensore = cmbSensore.selectedItem();

 // default topics
    topics = sensor[0].topic;

 // maps
    GoogleMap1.mapOptions.longitude = 7.6761;
    GoogleMap1.mapOptions.latitude = 45.0781;
    GoogleMap1.refresh();


 // get map identification
    point = new google.maps.LatLng(45.0781, 7.6761);
    mapOptions = {zoom: 10, center: point, zoomControl: False, disableDefaultUI: True}
    map = new google.maps.Map(document.getElementById("GoogleMap1"), mapOptions);

 // define marker

    for   (i = 0; i  <= (NUMSENSOR-1); i ++) {
        marker[i] = new google.maps.Marker({position: point, map: map, title: sensor[i].name + ": " + sensor[i].id});
        markerH[i] = new google.maps.Marker({position: point, map: map, title: sensor[i].name + ": " + sensor[i].id});
        icon = new google.maps.MarkerImage(""  +  (i+1)  +  ".png" , new google.maps.Size(32, 32),new google.maps.Point(0,0), new google.maps.Point(16, 16));
        marker[i].setIcon(icon);
        marker[i].setVisible(False);
        icon2 = new google.maps.MarkerImage(""  +  (i+1)  +  "x.png" , new google.maps.Size(32, 32),new google.maps.Point(0,0), new google.maps.Point(16, 16));
        markerH[i].setIcon(icon2);
        markerH[i].setVisible(False);
    }

    tblSensor.rows = NUMSENSOR + 1;
    autobounds = False;

    poliConfineCoords = [new google.maps.LatLng(45.030603, 7.640563), new google.maps.LatLng(45.041278, 7.589752), new google.maps.LatLng(45.036183, 7.551986), new google.maps.LatLng(45.057044, 7.530357), new google.maps.LatLng(45.079837,7.617904), new google.maps.LatLng(45.030603, 7.640563)];
    poliConfine = new google.maps.Polygon({path: poliConfineCoords, strokeColor: "#FF0000" , strokeOpacity: 1.0, strokeWeight: 3, fillColor: "#FF0000" , fillOpacity: 0.35});
    poliConfine.setMap(map);
    lineaConfineCoords = [new google.maps.LatLng(0, 7.6), new google.maps.LatLng(180, 7.6)];
    lineaConfine = new google.maps.Polyline({path: lineaConfineCoords, geodesic: True, strokeColor: "#0000FF" , strokeOpacity: 1.0, strokeWeight: 3});
    lineaConfine.setMap(map);


return savethefunction_rvar; }

fltBounds.onchange = function() { savethefunction_rvar="";
  if(fltBounds.value() == "On") {
      autobounds = True;
 } else {
      autobounds = False;
  }
return savethefunction_rvar; }

 // manage the topic selection 
cmbSensore.onchange = function() { savethefunction_rvar="";

    switch (True) {
    case ((cmbSensore.selectedValue()) == "phonegps01"):
        topics = sensor[0].topic;
	break;
    case ((cmbSensore.selectedValue()) == "phonegps02"):
        topics = sensor[1].topic;
	break;
    case ((cmbSensore.selectedValue()) == "phonegps03"):
        topics = sensor[2].topic;
	break;
    case ((cmbSensore.selectedValue()) == "phonegps04"):
        topics = sensor[3].topic;
	break;
    case ((cmbSensore.selectedValue()) == "phonegps05"):
        topics = sensor[4].topic;
	break;
    case ((cmbSensore.selectedValue()) == "all"):
      topics = "/topic/output.smartlab.internal_allgps";
	break;
    case ((cmbSensore.selectedValue()) == "allfilter"):
      topics = "/topic/output.smartlab.internal_allgpsfilterlong";
	break;
    case ((cmbSensore.selectedValue()) == "allfiltergeo"):
      topics = "/topic/output.smartlab.internal_allgpsfiltergeo";
      topics2 = "/topic/output.smartlab.internal_gpscounter";
    }

    lblSensore.Caption = cmbSensore.selectedValue();
    idSensore = cmbSensore.selectedItem();
return savethefunction_rvar; }

 // subscribe the topic
function connectCallBack(x) {
    btnConnetti.disabled = True;
    btnDisconnetti.disabled = False;
    cmbSensore.disabled = True;
    switch (True) {
    case ((cmbSensore.selectedValue()) == "phonegps01" ): case ((cmbSensore.selectedValue()) ==  "phonegps02" ): case ((cmbSensore.selectedValue()) ==  "phonegps03" ): case ((cmbSensore.selectedValue()) ==  "phonegps04" ): case ((cmbSensore.selectedValue()) ==  "phonegps05" ): case ((cmbSensore.selectedValue()) ==  "all" ): case ((cmbSensore.selectedValue()) ==  "allfilter"):
        client.subscribe(topics, messageCallback);
        _msgbox_confirm("You are connected and subscribed to topics: " + topics);
	break;
    case ((cmbSensore.selectedValue()) == "allfiltergeo"):
        client.subscribe(topics, messageCallback);
        client.subscribe(topics2, messageCallback2);
        _msgbox_confirm("You are connected and subscribed to topics: " + topics + '\n' + "and topic "+ topics2);
    }

}

 // connection error
function errorCallback(x) {
  btnConnetti.disabled = False;
  btnDisconnetti.disabled = True;
  cmbSensore.disabled = False;
  _msgbox_confirm("Connection error");
}

 // manage the stop message
function messageCallback(x) {
 var jsText;
 var obJSON;
 var latitude;
 var longitude;
 var altezza;
 var vel;
 var tstamp;
 var indice;
 var markerBounds;
 var inbound;

 // remove the stomp header
  jsText =""  +  x;
  p =  InStr(jsText, "{");
  jsText = Mid(jsText, p);

 // convert the JSON to an object
  obJSON = JSON.parse(jsText);

 // show the info on the screen

  ids = obJSON.sensor;
  indice = 0;
  for   (indice = 0; indice  <= (NUMSENSOR - 1); indice ++) {
    if(sensor[indice].id == ids) {
         break;
    }
  }

  if(indice >= NUMSENSOR) {
     return;
  }

  latitude = obJSON.values[0].components.latitude;
  longitude = obJSON.values[0].components.longitude;
  altezza =obJSON.values[0].components.altitude;
  vel = obJSON.values[0].components.speed;
  tstamp = obJSON.values[0].time;


  sensor[indice].marked = 1;
  sensor[indice].lat = latitude;
  sensor[indice].lon = longitude;
  sensor[indice].alt = altezza;
  sensor[indice].ts = tstamp;

  sensor[indice].inbound = "false";

  point = new google.maps.LatLng(latitude, longitude);

  if(cmbSensore.selectedValue() == "allfiltergeo") {
    inbound = obJSON.values[0].components.inbound;
    sensor[indice].inbound = inbound;

    if(inbound == "true") {
      markerH[indice].setPosition(point);
      markerH[indice].setVisible(True);
      marker[indice].setVisible(False);
 } else {
      marker[indice].setPosition(point);
      marker[indice].setVisible(True);
      markerH[indice].setVisible(False);
    }
 } else {
    marker[indice].setPosition(point);
    marker[indice].setVisible(True);
    markerH[indice].setVisible(False);
  }

 // refresh screen
  markerBounds = new google.maps.LatLngBounds();

  for   (i = 0; i  <= (NUMSENSOR - 1); i ++) {
    tblSensor.setValue(i+1,0,sensor[i].name);
    if(sensor[i].marked == 1) {
      if(autobounds == True) {
        pnt = new google.maps.LatLng(sensor[i].lat, sensor[i].lon);
        markerBounds.extend(pnt);
      }
      tblSensor.setValue(i+1, 1, sensor[i].ts);
      tblSensor.setValue(i+1, 2, sensor[i].lat);
      tblSensor.setValue(i+1, 3, sensor[i].lon);
      tblSensor.setValue(i+1, 4, sensor[i].alt);
      tblSensor.setValue(i+1, 5, sensor[i].speed);
      tblSensor.setValue(i+1, 6, sensor[i].inbound);
 } else {
      tblSensor.setValue(i+1, 1, "-");
      tblSensor.setValue(i+1, 2, "-");
      tblSensor.setValue(i+1, 3, "-");
      tblSensor.setValue(i+1, 4, "-");
      tblSensor.setValue(i+1, 5, "-");
      tblSensor.setValue(i+1, 6, "-");
    }
  }

  if(autobounds == False) {
      pnt = new google.maps.LatLng(45.020169, 7.527439);
      markerBounds.extend(pnt);
      pnt = new google.maps.LatLng(45.122730, 7.762615);
      markerBounds.extend(pnt);
  }

  map.fitBounds(markerBounds);

}

function messageCallback2(x) {
 var v;
  jsText =""  +  x;
  p =  InStr(jsText, "{");
  jsText = Mid(jsText, p);

 // convert the JSON to an object

  obJSON = JSON.parse(jsText);
  v = Math.floor(obJSON.values[0].components.counter);

  if(v == 0) {
    lblAlert.Caption = "no alert";
 } else {
    lblAlert.Caption = "Alert!!! " + v + " veicle(s) in restricted area";
  }
}

function disconnectCallback(x) {
  location = ".";

}







// Generated by CoffeeScript 1.3.3
(function() {
  var Byte, Client, Frame, Stomp,
    __hasProp = {}.hasOwnProperty;
  
  var MAX_FRAME_SIZE=16*1024;;
  
  Byte = {
    LF: '\x0A',
    NULL: '\x00'
  };

  Frame = (function() {

    function Frame(command, headers, body) {
      this.command = command;
      this.headers = headers != null ? headers : {};
      this.body = body != null ? body : '';
    }

    Frame.prototype.toString = function() {
      var lines, name, value, _ref;
      lines = [this.command];
      _ref = this.headers;
      for (name in _ref) {
        if (!__hasProp.call(_ref, name)) continue;
        value = _ref[name];
        lines.push("" + name + ":" + value);
      }
      if (this.body) {
        lines.push("content-length:" + ('' + this.body).length);
      }
      lines.push(Byte.LF + this.body);
      return lines.join(Byte.LF);
    };

    Frame._unmarshallSingle = function(data) {
      var body, chr, command, divider, headerLines, headers, i, idx, len, line, start, trim, _i, _j, _ref, _ref1;
      divider = data.search(RegExp("" + Byte.LF + Byte.LF));
      headerLines = data.substring(0, divider).split(Byte.LF);
      command = headerLines.shift();
      headers = {};
      trim = function(str) {
        return str.replace(/^\s+|\s+$/g, '');
      };
      line = idx = null;
      for (i = _i = 0, _ref = headerLines.length; 0 <= _ref ? _i < _ref : _i > _ref; i = 0 <= _ref ? ++_i : --_i) {
        line = headerLines[i];
        idx = line.indexOf(':');
        headers[trim(line.substring(0, idx))] = trim(line.substring(idx + 1));
      }
      body = '';
      start = divider + 2;
      if (headers['content-length']) {
        len = parseInt(headers['content-length']);
        body = ('' + data).substring(start, start + len);
      } else {
        chr = null;
        for (i = _j = start, _ref1 = data.length; start <= _ref1 ? _j < _ref1 : _j > _ref1; i = start <= _ref1 ? ++_j : --_j) {
          chr = data.charAt(i);
          if (chr === Byte.NULL) {
            break;
          }
          body += chr;
        }
      }
      return new Frame(command, headers, body);
    };

    Frame.unmarshall = function(datas) {
      var data;
      return (function() {
        var _i, _len, _ref, _results;
        _ref = datas.split(RegExp("" + Byte.NULL + Byte.LF + "*"));
        _results = [];
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          data = _ref[_i];
          if ((data != null ? data.length : void 0) > 0) {
            _results.push(Frame._unmarshallSingle(data));
          }
        }
        return _results;
      })();
    };

    Frame.marshall = function(command, headers, body) {
      var frame;
      frame = new Frame(command, headers, body);
      return frame.toString() + Byte.NULL;
    };

    return Frame;

  })();

  Client = (function() {

    function Client(ws) {
      this.ws = ws;
      this.ws.binaryType = "arraybuffer";
      this.counter = 0;
      this.connected = false;
      this.heartbeat = {
        outgoing: 10000,
        incoming: 10000
      };
      this.subscriptions = {};
    }

    Client.prototype._transmit = function(command, headers, body) {
      var out;
      out = Frame.marshall(command, headers, body);
      if (typeof this.debug === "function") {
        this.debug(">>> " + out);
      }
      while( true) {
        if( out.length > MAX_FRAME_SIZE ) {
          this.ws.send(out.substring(0, MAX_FRAME_SIZE));
          out = out.substring(MAX_FRAME_SIZE);
        } else {
          return this.ws.send(out);
        }
      }
    };

    Client.prototype._setupHeartbeat = function(headers) {
      var serverIncoming, serverOutgoing, ttl, v, _ref, _ref1,
        _this = this;
      if ((_ref = headers.version) !== Stomp.VERSIONS.V1_1 && _ref !== Stomp.VERSIONS.V1_2) {
        return;
      }
      _ref1 = (function() {
        var _i, _len, _ref1, _results;
        _ref1 = headers['heart-beat'].split(",");
        _results = [];
        for (_i = 0, _len = _ref1.length; _i < _len; _i++) {
          v = _ref1[_i];
          _results.push(parseInt(v));
        }
        return _results;
      })(), serverOutgoing = _ref1[0], serverIncoming = _ref1[1];
      if (!(this.heartbeat.outgoing === 0 || serverIncoming === 0)) {
        ttl = Math.max(this.heartbeat.outgoing, serverIncoming);
        if (typeof this.debug === "function") {
          this.debug("send PING every " + ttl + "ms");
        }
        this.pinger = typeof window !== "undefined" && window !== null ? window.setInterval(function() {
          _this.ws.send(Byte.LF);
          return typeof _this.debug === "function" ? _this.debug(">>> PING") : void 0;
        }, ttl) : void 0;
      }
      if (!(this.heartbeat.incoming === 0 || serverOutgoing === 0)) {
        ttl = Math.max(this.heartbeat.incoming, serverOutgoing);
        if (typeof this.debug === "function") {
          this.debug("check PONG every " + ttl + "ms");
        }
        return this.ponger = typeof window !== "undefined" && window !== null ? window.setInterval(function() {
          var delta;
          delta = Date.now() - _this.serverActivity;
          if (delta > ttl * 2) {
            if (typeof _this.debug === "function") {
              _this.debug("did not receive server activity for the last " + delta + "ms");
            }
            return _this._cleanUp();
          }
        }, ttl) : void 0;
      }
    };

    Client.prototype.connect = function(login, passcode, connectCallback, errorCallback, vhost) {
      var _this = this;
      this.connectCallback = connectCallback;
      if (typeof this.debug === "function") {
        this.debug("Opening Web Socket...");
      }
      this.ws.onmessage = function(evt) {
        var arr, c, data, frame, onreceive, _i, _len, _ref, _results;
        data = typeof ArrayBuffer !== 'undefined' && evt.data instanceof ArrayBuffer ? (arr = new Uint8Array(evt.data), typeof _this.debug === "function" ? _this.debug("--- got data length: " + arr.length) : void 0, ((function() {
          var _i, _len, _results;
          _results = [];
          for (_i = 0, _len = arr.length; _i < _len; _i++) {
            c = arr[_i];
            _results.push(String.fromCharCode(c));
          }
          return _results;
        })()).join('')) : evt.data;
        _this.serverActivity = Date.now();
        if (data === Byte.LF) {
          if (typeof _this.debug === "function") {
            _this.debug("<<< PONG");
          }
          return;
        }
        if (typeof _this.debug === "function") {
          _this.debug("<<< " + data);
        }
        _ref = Frame.unmarshall(data);
        _results = [];
        for (_i = 0, _len = _ref.length; _i < _len; _i++) {
          frame = _ref[_i];
          switch (frame.command) {
            case "CONNECTED":
              if (typeof _this.debug === "function") {
                _this.debug("connected to server " + frame.headers.server);
              }
              _this.connected = true;
              _this._setupHeartbeat(frame.headers);
              _results.push(typeof _this.connectCallback === "function" ? _this.connectCallback(frame) : void 0);
              break;
            case "MESSAGE":
              onreceive = _this.subscriptions[frame.headers.subscription];
              _results.push(typeof onreceive === "function" ? onreceive(frame) : void 0);
              break;
            case "RECEIPT":
              _results.push(typeof _this.onreceipt === "function" ? _this.onreceipt(frame) : void 0);
              break;
            case "ERROR":
              _results.push(typeof errorCallback === "function" ? errorCallback(frame) : void 0);
              break;
            default:
              _results.push(typeof _this.debug === "function" ? _this.debug("Unhandled frame: " + frame) : void 0);
          }
        }
        return _results;
      };
      this.ws.onclose = function() {
        var msg;
        msg = "Whoops! Lost connection to " + _this.ws.url;
        if (typeof _this.debug === "function") {
          _this.debug(msg);
        }
        return typeof errorCallback === "function" ? errorCallback(msg) : void 0;
      };
      return this.ws.onopen = function() {
        var headers;
        if (typeof _this.debug === "function") {
          _this.debug('Web Socket Opened...');
        }
        headers = {
          "accept-version": Stomp.VERSIONS.supportedVersions(),
          "heart-beat": [_this.heartbeat.outgoing, _this.heartbeat.incoming].join(',')
        };
        if (vhost) {
          headers.host = vhost;
        }
        if (login) {
          headers.login = login;
        }
        if (passcode) {
          headers.passcode = passcode;
        }
        return _this._transmit("CONNECT", headers);
      };
    };

    Client.prototype.disconnect = function(disconnectCallback) {
      this._transmit("DISCONNECT");
      this.ws.onclose = null;
      this._cleanUp();
      return typeof disconnectCallback === "function" ? disconnectCallback() : void 0;
    };

    Client.prototype._cleanUp = function() {
      this.ws.close();
      this.connected = false;
      if (this.pinger) {
        if (typeof window !== "undefined" && window !== null) {
          window.clearInterval(this.pinger);
        }
      }
      if (this.ponger) {
        return typeof window !== "undefined" && window !== null ? window.clearInterval(this.ponger) : void 0;
      }
    };

    Client.prototype.send = function(destination, headers, body) {
      if (headers == null) {
        headers = {};
      }
      if (body == null) {
        body = '';
      }
      headers.destination = destination;
      return this._transmit("SEND", headers, body);
    };

    Client.prototype.subscribe = function(destination, callback, headers) {
      if (headers == null) {
        headers = {};
      }
      if (!headers.id) {
        headers.id = "sub-" + this.counter++;
      }
      headers.destination = destination;
      this.subscriptions[headers.id] = callback;
      this._transmit("SUBSCRIBE", headers);
      return headers.id;
    };

    Client.prototype.unsubscribe = function(id) {
      delete this.subscriptions[id];
      return this._transmit("UNSUBSCRIBE", {
        id: id
      });
    };

    Client.prototype.begin = function(transaction) {
      return this._transmit("BEGIN", {
        transaction: transaction
      });
    };

    Client.prototype.commit = function(transaction) {
      return this._transmit("COMMIT", {
        transaction: transaction
      });
    };

    Client.prototype.abort = function(transaction) {
      return this._transmit("ABORT", {
        transaction: transaction
      });
    };

    Client.prototype.ack = function(messageID, subscription, headers) {
      if (headers == null) {
        headers = {};
      }
      headers["message-id"] = messageID;
      headers.subscription = subscription;
      return this._transmit("ACK", headers);
    };

    Client.prototype.nack = function(messageID, subscription, headers) {
      if (headers == null) {
        headers = {};
      }
      headers["message-id"] = messageID;
      headers.subscription = subscription;
      return this._transmit("NACK", headers);
    };

    return Client;

  })();

  Stomp = {
    libVersion: "2.0.0-next",
    VERSIONS: {
      V1_0: '1.0',
      V1_1: '1.1',
      V1_2: '1.2',
      supportedVersions: function() {
        return '1.1,1.0';
      }
    },
    client: function(url, protocols) {
      var klass, ws;
      if (protocols == null) {
        protocols = ['v10.stomp', 'v11.stomp'];
      }
      klass = Stomp.WebSocketClass || WebSocket;
      ws = new klass(url, protocols);
      return new Client(ws);
    },
    over: function(ws) {
      return new Client(ws);
    },
    Frame: Frame
  };

  if (typeof window !== "undefined" && window !== null) {
    window.Stomp = Stomp;
  } else {
    exports.Stomp = Stomp;
    Stomp.WebSocketClass = require('./test/server.mock.js').StompServerMock;
  }

}).call(this);

window.addEventListener('orientationchange', function(){window.scrollTo(0,0)});
window.addEventListener('load', function() {
  browserWarningMessage('Please use Google Chrome, Apple Safari or another supported browser.');
  Form1.style.display = 'block';
  Main();
  if (typeof(Form1.onshow)=='function') Form1.onshow();
  
}, false);

var NSBCurrentForm = Form1;




</script>

</body>
</html>